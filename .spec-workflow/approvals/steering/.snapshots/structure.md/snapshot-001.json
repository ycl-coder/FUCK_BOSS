{
  "id": "snapshot_1767670177720_6swwcmqzn",
  "approvalId": "approval_1767670177695_ylrm4sakh",
  "approvalTitle": "项目结构文档 (structure.md) - 文档组织规范",
  "version": 1,
  "timestamp": "2026-01-06T03:29:37.720Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Project Structure\n\n## Directory Organization\n\n```\nfuck_boss/\n├── docs/                           # 文档目录（统一管理）\n│   ├── design/                     # 设计文档\n│   │   ├── architecture.md         # 架构设计\n│   │   ├── database-schema.md      # 数据库设计\n│   │   └── api-design.md           # API 设计\n│   ├── development/                # 开发文档\n│   │   ├── setup-guide.md          # 环境搭建指南\n│   │   ├── development-guide.md    # 开发指南\n│   │   └── testing-guide.md        # 测试指南\n│   ├── deployment/                 # 部署文档\n│   │   ├── docker-deploy.md        # Docker 部署\n│   │   └── production-deploy.md    # 生产环境部署\n│   ├── fixes/                      # 修复文档（问题修复记录）\n│   │   ├── bug-fixes/              # Bug 修复记录\n│   │   ├── performance-fixes/      # 性能优化记录\n│   │   └── security-fixes/         # 安全修复记录\n│   └── changelog/                  # 变更日志\n│       └── CHANGELOG.md            # 版本变更记录\n│\n├── backend/                        # 后端代码（Go + gRPC）\n│   ├── cmd/                        # 应用程序入口\n│   │   └── server/                 # gRPC 服务器入口\n│   │       └── main.go\n│   ├── internal/                   # 内部代码（不对外暴露）\n│   │   ├── domain/                 # 领域层（DDD）\n│   │   │   ├── content/            # 内容领域\n│   │   │   │   ├── entity.go       # Post 实体\n│   │   │   │   ├── value_object.go # 值对象\n│   │   │   │   ├── repository.go   # Repository 接口\n│   │   │   │   └── service.go      # 领域服务\n│   │   │   ├── search/             # 搜索领域\n│   │   │   │   ├── entity.go\n│   │   │   │   ├── repository.go\n│   │   │   │   └── service.go\n│   │   │   └── shared/             # 共享领域概念\n│   │   │       ├── city.go         # 城市值对象\n│   │   │       └── company.go      # 公司值对象\n│   │   │\n│   │   ├── application/            # 应用层（Use Cases）\n│   │   │   ├── content/            # 内容用例\n│   │   │   │   ├── create_post.go  # 创建曝光用例\n│   │   │   │   ├── get_post.go     # 获取曝光用例\n│   │   │   │   └── list_posts.go   # 列表查询用例\n│   │   │   ├── search/             # 搜索用例\n│   │   │   │   └── search_posts.go\n│   │   │   └── dto/                # 数据传输对象\n│   │   │       ├── content_dto.go\n│   │   │       └── search_dto.go\n│   │   │\n│   │   ├── infrastructure/         # 基础设施层\n│   │   │   ├── persistence/        # 持久化实现\n│   │   │   │   ├── postgres/       # PostgreSQL 实现\n│   │   │   │   │   ├── post_repository.go\n│   │   │   │   │   └── migrations/ # 数据库迁移\n│   │   │   │   └── redis/          # Redis 实现\n│   │   │   │       └── cache_repository.go\n│   │   │   ├── config/             # 配置管理\n│   │   │   │   └── config.go\n│   │   │   └── logger/             # 日志\n│   │   │       └── logger.go\n│   │   │\n│   │   └── presentation/           # 表现层\n│   │       ├── grpc/               # gRPC 处理器\n│   │       │   ├── content_handler.go\n│   │       │   └── search_handler.go\n│   │       └── middleware/         # 中间件\n│   │           ├── logging.go\n│   │           └── recovery.go\n│   │\n│   ├── pkg/                        # 可复用的公共包\n│   │   ├── errors/                 # 错误定义\n│   │   ├── validator/              # 验证工具\n│   │   └── utils/                  # 工具函数\n│   │\n│   ├── api/                        # API 定义（protobuf）\n│   │   └── proto/                  # .proto 文件\n│   │       ├── content/\n│   │       │   └── content.proto\n│   │       └── search/\n│   │           └── search.proto\n│   │\n│   ├── scripts/                    # 脚本文件\n│   │   ├── migrate.sh              # 数据库迁移脚本\n│   │   └── generate.sh             # 代码生成脚本\n│   │\n│   ├── test/                       # 测试文件\n│   │   ├── unit/                   # 单元测试\n│   │   ├── integration/            # 集成测试\n│   │   │   ├── testdata/           # 测试数据\n│   │   │   └── docker-compose.test.yml\n│   │   └── e2e/                    # 端到端测试\n│   │\n│   ├── go.mod                      # Go 模块定义\n│   ├── go.sum                      # 依赖校验\n│   ├── Makefile                    # 构建脚本\n│   └── Dockerfile                  # Docker 镜像\n│\n├── frontend/                       # 前端代码（React）\n│   ├── public/                     # 静态资源\n│   ├── src/\n│   │   ├── api/                    # API 客户端\n│   │   │   ├── grpc/               # gRPC 客户端\n│   │   │   │   ├── contentClient.ts\n│   │   │   │   └── searchClient.ts\n│   │   │   └── types/              # API 类型定义\n│   │   │\n│   │   ├── domain/                 # 领域模型（前端）\n│   │   │   ├── models/             # 数据模型\n│   │   │   │   ├── Post.ts\n│   │   │   │   └── City.ts\n│   │   │   └── services/           # 领域服务\n│   │   │       └── postService.ts\n│   │   │\n│   │   ├── features/               # 功能模块（按功能组织）\n│   │   │   ├── post/               # 曝光内容功能\n│   │   │   │   ├── components/    # 组件\n│   │   │   │   │   ├── PostList.tsx\n│   │   │   │   │   ├── PostDetail.tsx\n│   │   │   │   │   └── PostForm.tsx\n│   │   │   │   ├── hooks/         # React Hooks\n│   │   │   │   │   └── usePosts.ts\n│   │   │   │   └── index.ts       # 导出\n│   │   │   │\n│   │   │   ├── search/             # 搜索功能\n│   │   │   │   ├── components/\n│   │   │   │   │   └── SearchBar.tsx\n│   │   │   │   └── hooks/\n│   │   │   │       └── useSearch.ts\n│   │   │   │\n│   │   │   └── city/               # 城市选择功能\n│   │   │       └── components/\n│   │   │           └── CitySelector.tsx\n│   │   │\n│   │   ├── shared/                # 共享代码\n│   │   │   ├── components/        # 通用组件\n│   │   │   │   ├── Button.tsx\n│   │   │   │   └── Card.tsx\n│   │   │   ├── hooks/             # 通用 Hooks\n│   │   │   ├── utils/             # 工具函数\n│   │   │   └── constants/         # 常量\n│   │   │\n│   │   ├── app/                   # 应用入口\n│   │   │   ├── App.tsx\n│   │   │   ├── routes.tsx         # 路由配置\n│   │   │   └── store.ts           # 状态管理\n│   │   │\n│   │   └── main.tsx               # 入口文件\n│   │\n│   ├── test/                       # 测试文件\n│   │   ├── unit/                  # 单元测试\n│   │   ├── integration/           # 集成测试\n│   │   └── e2e/                   # 端到端测试\n│   │\n│   ├── package.json\n│   ├── tsconfig.json\n│   ├── vite.config.ts\n│   └── Dockerfile\n│\n├── .spec-workflow/                 # 规范工作流文档\n│   ├── steering/                   # 指导文档\n│   │   ├── product.md\n│   │   ├── tech.md\n│   │   └── structure.md\n│   └── specs/                     # 功能规范\n│\n├── docker-compose.yml              # 开发环境 Docker Compose\n├── docker-compose.test.yml        # 测试环境 Docker Compose\n├── .gitignore\n├── README.md                       # 项目说明（指向 docs/）\n└── Makefile                        # 项目级构建脚本\n```\n\n## Naming Conventions\n\n### Files\n\n#### 后端 (Go)\n- **包名**: `snake_case` (小写，单词间用下划线)\n- **文件名**: `snake_case.go` (与包名一致)\n- **测试文件**: `snake_case_test.go`\n- **接口文件**: `repository.go`, `service.go`\n- **实现文件**: `postgres_repository.go`, `redis_cache.go`\n\n#### 前端 (TypeScript/React)\n- **组件文件**: `PascalCase.tsx` (如 `PostList.tsx`)\n- **工具文件**: `camelCase.ts` (如 `formatDate.ts`)\n- **类型文件**: `types.ts` 或 `*.types.ts`\n- **测试文件**: `*.test.tsx` 或 `*.spec.tsx`\n- **配置文件**: `kebab-case.config.ts` (如 `vite.config.ts`)\n\n### Code\n\n#### 后端 (Go)\n- **包名**: `snake_case` (全小写)\n- **类型/结构体**: `PascalCase` (如 `Post`, `PostRepository`)\n- **接口**: `PascalCase` + `er` 后缀 (如 `PostRepository`, `CacheRepository`)\n- **函数/方法**: `camelCase` (如 `CreatePost`, `GetPostByID`)\n- **常量**: `UPPER_SNAKE_CASE` (如 `MAX_POST_LENGTH`)\n- **变量**: `camelCase` (如 `postID`, `cityName`)\n- **私有成员**: 小写开头 (如 `postRepository`)\n- **公开成员**: 大写开头 (如 `PostRepository`)\n\n#### 前端 (TypeScript)\n- **组件**: `PascalCase` (如 `PostList`)\n- **函数/变量**: `camelCase` (如 `getPosts`, `postList`)\n- **类型/接口**: `PascalCase` (如 `Post`, `PostDTO`)\n- **常量**: `UPPER_SNAKE_CASE` (如 `MAX_POST_LENGTH`)\n- **枚举**: `PascalCase` (如 `PostStatus`)\n\n## Import Patterns\n\n### 后端 (Go)\n\n#### Import Order\n1. 标准库 (`fmt`, `context`, `time`)\n2. 第三方库 (`google.golang.org/grpc`, `github.com/...`)\n3. 项目内部包 (`internal/domain`, `pkg/utils`)\n\n#### 示例\n```go\npackage handler\n\nimport (\n    \"context\"\n    \"time\"\n    \n    \"google.golang.org/grpc\"\n    \"github.com/lib/pq\"\n    \n    \"fuck_boss/internal/domain/content\"\n    \"fuck_boss/pkg/errors\"\n)\n```\n\n### 前端 (TypeScript)\n\n#### Import Order\n1. React 相关 (`react`, `react-dom`)\n2. 第三方库 (`axios`, `zustand`)\n3. 项目内部 (`@/api`, `@/domain`, `@/shared`)\n\n#### 路径别名配置\n```typescript\n// tsconfig.json\n{\n  \"compilerOptions\": {\n    \"paths\": {\n      \"@/*\": [\"src/*\"],\n      \"@/api/*\": [\"src/api/*\"],\n      \"@/domain/*\": [\"src/domain/*\"],\n      \"@/shared/*\": [\"src/shared/*\"]\n    }\n  }\n}\n```\n\n## Code Structure Patterns\n\n### 后端 (Go) - DDD 分层\n\n#### Domain Layer 文件结构\n```go\n// domain/content/entity.go\npackage content\n\n// Post 聚合根\ntype Post struct {\n    id        PostID\n    company   CompanyName\n    city      City\n    content   Content\n    createdAt time.Time\n}\n\n// 业务方法\nfunc (p *Post) Publish() error {\n    // 领域逻辑\n}\n\n// domain/content/repository.go\npackage content\n\ntype Repository interface {\n    Save(ctx context.Context, post *Post) error\n    FindByID(ctx context.Context, id PostID) (*Post, error)\n}\n```\n\n#### Application Layer 文件结构\n```go\n// application/content/create_post.go\npackage content\n\ntype CreatePostUseCase struct {\n    repo domain.Repository\n}\n\nfunc (uc *CreatePostUseCase) Execute(ctx context.Context, cmd CreatePostCommand) (*PostDTO, error) {\n    // 1. 验证输入\n    // 2. 创建领域对象\n    // 3. 调用 Repository\n    // 4. 返回 DTO\n}\n```\n\n#### Infrastructure Layer 文件结构\n```go\n// infrastructure/persistence/postgres/post_repository.go\npackage postgres\n\ntype PostRepository struct {\n    db *sql.DB\n}\n\nfunc (r *PostRepository) Save(ctx context.Context, post *domain.Post) error {\n    // 实现数据库操作\n}\n```\n\n### 前端 (React) - 功能模块组织\n\n#### 功能模块结构\n```typescript\n// features/post/components/PostList.tsx\nexport const PostList: React.FC<PostListProps> = ({ posts }) => {\n    // 组件实现\n}\n\n// features/post/hooks/usePosts.ts\nexport const usePosts = () => {\n    // Hook 实现\n}\n\n// features/post/index.ts\nexport { PostList } from './components/PostList'\nexport { usePosts } from './hooks/usePosts'\n```\n\n## Code Organization Principles\n\n1. **单一职责**: 每个文件、函数只做一件事\n2. **依赖倒置**: 依赖接口而非实现\n3. **领域驱动**: 业务逻辑集中在 Domain Layer\n4. **测试友好**: 代码结构便于测试\n5. **一致性**: 遵循项目既定的模式和约定\n\n## Module Boundaries\n\n### 后端分层边界\n\n```\nPresentation Layer\n    ↓ (依赖)\nApplication Layer\n    ↓ (依赖)\nDomain Layer\n    ↑ (实现)\nInfrastructure Layer\n```\n\n**规则**:\n- Domain Layer 不依赖任何其他层（最纯净）\n- Application Layer 只依赖 Domain Layer\n- Infrastructure Layer 实现 Domain Layer 定义的接口\n- Presentation Layer 调用 Application Layer 的 Use Cases\n\n### 前端模块边界\n\n```\nFeatures (功能模块)\n    ↓ (使用)\nDomain (领域模型)\n    ↓ (使用)\nAPI (API 客户端)\n    ↓ (使用)\nShared (共享组件)\n```\n\n**规则**:\n- Features 之间相互独立，通过 Shared 共享\n- Domain 定义业务模型，不依赖 UI\n- API 层独立，可替换实现\n\n## Code Size Guidelines\n\n### 后端 (Go)\n- **文件大小**: 建议 < 500 行\n- **函数大小**: 建议 < 50 行\n- **结构体复杂度**: 建议 < 10 个字段\n- **嵌套深度**: 建议 < 4 层\n\n### 前端 (TypeScript)\n- **组件文件**: 建议 < 300 行\n- **函数大小**: 建议 < 50 行\n- **组件复杂度**: 建议 < 10 个 props\n- **嵌套深度**: 建议 < 3 层 JSX\n\n## Documentation Standards\n\n### 文档组织原则\n\n**所有文档统一放在 `docs/` 目录下，按类型分类**:\n\n```\ndocs/\n├── design/              # 设计文档（架构、数据库、API）\n├── development/         # 开发文档（环境搭建、开发指南、测试）\n├── deployment/          # 部署文档\n├── fixes/               # 修复文档（问题修复记录）\n│   ├── bug-fixes/       # Bug 修复\n│   ├── performance-fixes/  # 性能优化\n│   └── security-fixes/  # 安全修复\n└── changelog/           # 变更日志\n```\n\n### 文档命名规范\n\n- **设计文档**: `kebab-case.md` (如 `database-schema.md`)\n- **开发文档**: `kebab-case-guide.md` (如 `setup-guide.md`)\n- **修复文档**: `YYYY-MM-DD-issue-description.md` (如 `2026-01-06-redis-connection-fix.md`)\n\n### 代码文档要求\n\n#### 后端 (Go)\n- **公开函数**: 必须有 `// FunctionName 描述` 注释\n- **公开类型**: 必须有类型说明\n- **复杂逻辑**: 必须有行内注释\n- **包级别**: 每个包必须有 `package` 注释\n\n```go\n// Package content provides domain models and services for content management.\npackage content\n\n// Post represents a company misconduct exposure post.\ntype Post struct {\n    // ID is the unique identifier of the post.\n    ID PostID\n    \n    // Company is the name of the company being exposed.\n    Company CompanyName\n}\n\n// CreatePost creates a new post in the system.\n// It validates the input and persists the post to the repository.\nfunc CreatePost(ctx context.Context, repo Repository, cmd CreateCommand) (*Post, error) {\n    // Implementation\n}\n```\n\n#### 前端 (TypeScript)\n- **组件**: 必须有 JSDoc 注释说明 props\n- **函数**: 复杂函数必须有注释\n- **类型**: 公开类型必须有注释\n\n```typescript\n/**\n * PostList component displays a list of company exposure posts.\n * \n * @param posts - Array of posts to display\n * @param onPostClick - Callback when a post is clicked\n */\nexport const PostList: React.FC<PostListProps> = ({ posts, onPostClick }) => {\n    // Implementation\n}\n```\n\n### 修复文档模板\n\n每次修复问题后，在 `docs/fixes/` 相应目录下创建修复文档：\n\n```markdown\n# [日期] - [问题描述]\n\n## 问题描述\n[详细描述问题]\n\n## 原因分析\n[分析问题根本原因]\n\n## 解决方案\n[描述解决方案]\n\n## 测试验证\n[描述如何验证修复]\n\n## 相关文件\n- `path/to/file.go`\n- `path/to/file.ts`\n\n## 影响范围\n[描述影响范围]\n```\n\n## Testing Structure\n\n### 测试文件组织\n\n```\nbackend/test/\n├── unit/                    # 单元测试\n│   ├── domain/             # 领域层测试\n│   ├── application/        # 应用层测试\n│   └── infrastructure/     # 基础设施层测试\n│\n├── integration/            # 集成测试\n│   ├── repository/        # Repository 集成测试\n│   ├── cache/             # 缓存集成测试\n│   └── grpc/              # gRPC 服务集成测试\n│\n└── e2e/                    # 端到端测试\n    └── scenarios/          # 用户场景测试\n\nfrontend/test/\n├── unit/                   # 单元测试\n│   ├── components/        # 组件测试\n│   ├── hooks/             # Hook 测试\n│   └── utils/             # 工具函数测试\n│\n├── integration/           # 集成测试\n│   └── api/               # API 集成测试\n│\n└── e2e/                    # 端到端测试\n    └── flows/              # 用户流程测试\n```\n\n### 测试文件命名\n\n- **单元测试**: `*_test.go` (Go), `*.test.tsx` (TypeScript)\n- **集成测试**: `*_integration_test.go`, `*.integration.test.ts`\n- **E2E 测试**: `*_e2e_test.go`, `*.e2e.test.ts`\n\n## Build & Scripts\n\n### Makefile 结构\n\n```makefile\n.PHONY: help build test lint\n\n# 后端\nbackend-build:\nbackend-test:\nbackend-lint:\n\n# 前端\nfrontend-build:\nfrontend-test:\nfrontend-lint:\n\n# 数据库\ndb-migrate:\ndb-rollback:\n\n# Docker\ndocker-up:\ndocker-down:\n\n# 测试环境\ntest-up:        # 启动测试环境（PostgreSQL + Redis）\ntest-down:\n```\n\n### 脚本文件位置\n\n- **构建脚本**: `backend/scripts/`, `frontend/scripts/`\n- **部署脚本**: `scripts/deploy/`\n- **工具脚本**: `scripts/tools/`\n\n",
  "fileStats": {
    "size": 18528,
    "lines": 574,
    "lastModified": "2026-01-06T03:29:02.776Z"
  },
  "comments": []
}